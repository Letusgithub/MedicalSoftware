<%- include('../partials/headercode.ejs') %>

  <body>

    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar  ">
      <div class="layout-container">

        <!-- sidebar imported -->
        <%- include('../partials/sidebar.ejs') %>

          <!-- Layout container -->
          <div class="layout-page">

            <!-- navbar imported -->
            <%- include('../partials/navbar.ejs') %>

              <!-- Content wrapper -->
              <div class="content-wrapper">

                <!-- Content -->

                <div class="container-xxl flex-grow-1 container-p-y">

                  <div class="d-flex justify-content-between m-0 p-0">
                    <h4 class="fw-bold py-3 mb-1"> Update Distributor Details</h4>
                    <a type="button" class="btn btn-icon btn-danger my-2 mx-3" href="/vendor_list">
                      <i class='bx bx-x bx-sm'></i>
                    </a>
                  </div>

                  <hr class="mb-4">

                  <div class="card mb-4 mx-auto col-md-10">

                    <div class="card-body ">

                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="vendor_name">Distributor
                          Name</label>
                        <div class="col-sm-10">
                          <div class="input-group input-group-merge">
                            <span id="basic-icon-default-fullname2" class="input-group-text"><i
                                class="bx bx-user"></i></span>
                            <input type="text" class="form-control" id="vendor_name" placeholder="" name="vendor_name"
                              value="<%=vendor[0].vendor_name%>">
                          </div>
                        </div>
                      </div>

                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="vendor_contact">Contact
                          Number</label>
                        <div class="col-sm-10">
                          <div class="input-group input-group-merge">
                            <span id="basic-icon-default-phone2" class="input-group-text"><i
                                class="bx bx-phone"></i></span>
                            <input type="text" id="vendor_contact" class="form-control phone-mask" placeholder=""
                              name="vendor_contact" value="<%=vendor[0].vendor_contact%>">
                          </div>
                        </div>
                      </div>

                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="vendor_email">Email</label>
                        <div class="col-sm-10">
                          <div class="input-group input-group-merge">
                            <span class="input-group-text"><i class="bx bx-envelope"></i></span>
                            <input type="text" id="vendor_email" class="form-control" placeholder="" name="vendor_email"
                              value="<%=vendor[0].vendor_email%>">
                          </div>
                        </div>
                      </div>

                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="vendor_gstin">GSTIN</label>
                        <div class="col-sm-10">
                          <div class="input-group input-group-merge">
                            <span id="basic-icon-default-phone2" class="input-group-text"><i
                                class="bx bxs-bank"></i></span>
                            <input type="text" id="vendor_gstin" class="form-control phone-mask" placeholder=""
                              name="vendor_gstin" value="<%=vendor[0].vendor_gstin %>">
                          </div>
                        </div>
                      </div>

                      <div class="row mb-2">
                        <label class="col-2 col-form-label" for="org_dl_no_1">DL Number 1<span
                            style="font-size: 15px; color: red">*</span></label>
                        <div class="col-4">
                          <div class="input-group input-group-merge">
                            <span id="basic-icon-default-fullname2" class="input-group-text border"><i
                                class='bx bx-detail'></i></span>
                            <input type="text" id="dl1_ft" value="20" style="text-align: center;"
                              class="form-control border" readonly>
                            <select type="text" id="dl1_st" placeholder="State (eg:-MH)"
                              class="form-control border px-1">
                              <option value="" selected> State</option>
                              <option value="AD">Andhra Pradesh</option>
                              <option value="AR"> Arunachal Pradesh</option>
                              <option value="AS"> Assam</option>
                              <option value="BR"> Bihar</option>
                              <option value="CG"> Chattisgarh</option>
                              <option value="DL"> Delhi</option>
                              <option value="GA"> Goa</option>
                              <option value="GJ"> Gujarat</option>
                              <option value="HR"> Haryana</option>
                              <option value="HP"> Himachal Pradesh</option>
                              <option value="JK"> Jammu and Kashmir</option>
                              <option value="JH"> Jharkhand</option>
                              <option value="KA"> Karnataka</option>
                              <option value="KL"> Kerala</option>
                              <option value="LD"> Lakshadweep Islands</option>
                              <option value="MP"> Madhya Pradesh</option>
                              <option value="MH"> Maharashtra</option>
                              <option value="MN"> Manipur</option>
                              <option value="ML"> Meghalaya</option>
                              <option value="MZ"> Mizoram</option>
                              <option value="NL"> Nagaland</option>
                              <option value="OD"> Odisha</option>
                              <option value="PY"> Pondicherry</option>
                              <option value="PB"> Punjab</option>
                              <option value="RJ"> Rajasthan</option>
                              <option value="SK"> Sikkim</option>
                              <option value="TN"> Tamil Nadu</option>
                              <option value="TS"> Telangana</option>
                              <option value="TR"> Tripura</option>
                              <option value="UP"> Uttar Pradesh</option>
                              <option value="UK"> Uttarakhand</option>
                              <option value="WB"> West Bengal</option>
                            </select>
                            <input type="text" id="dl1_ct" style="text-align: center;" placeholder="City"
                              class="form-control border">
                            <input type="text" id="dl1_ln" style="text-align: center;" placeholder="Lic. no."
                              class="form-control border" minlength="6" maxlength="6">
                          </div>
                        </div>

                        <label class="col-2 col-form-label ps-4" style="text-align: center;" for="org_dl_no_2">DL Number
                          2<span style="font-size: 15px; color: red">*</span></label>
                        <div class="col-4">
                          <div class="input-group input-group-merge">
                            <span id="basic-icon-default-fullname2" class="input-group-text border"><i
                                class='bx bx-detail'></i></span>
                            <input type="text" id="dl2_ft" value="21" style="text-align: center;"
                              class="form-control border" readonly>
                            <select type="text" id="dl2_st" placeholder="State (eg:-MH)"
                              class="form-control border px-1">
                              <option value="" selected> State</option>
                              <option value="AD">Andhra Pradesh</option>
                              <option value="AR"> Arunachal Pradesh</option>
                              <option value="AS"> Assam</option>
                              <option value="BR"> Bihar</option>
                              <option value="CG"> Chattisgarh</option>
                              <option value="DL"> Delhi</option>
                              <option value="GA"> Goa</option>
                              <option value="GJ"> Gujarat</option>
                              <option value="HR"> Haryana</option>
                              <option value="HP"> Himachal Pradesh</option>
                              <option value="JK"> Jammu and Kashmir</option>
                              <option value="JH"> Jharkhand</option>
                              <option value="KA"> Karnataka</option>
                              <option value="KL"> Kerala</option>
                              <option value="LD"> Lakshadweep Islands</option>
                              <option value="MP"> Madhya Pradesh</option>
                              <option value="MH"> Maharashtra</option>
                              <option value="MN"> Manipur</option>
                              <option value="ML"> Meghalaya</option>
                              <option value="MZ"> Mizoram</option>
                              <option value="NL"> Nagaland</option>
                              <option value="OD"> Odisha</option>
                              <option value="PY"> Pondicherry</option>
                              <option value="PB"> Punjab</option>
                              <option value="RJ"> Rajasthan</option>
                              <option value="SK"> Sikkim</option>
                              <option value="TN"> Tamil Nadu</option>
                              <option value="TS"> Telangana</option>
                              <option value="TR"> Tripura</option>
                              <option value="UP"> Uttar Pradesh</option>
                              <option value="UK"> Uttarakhand</option>
                              <option value="WB"> West Bengal</option>
                            </select>
                            <input type="text" id="dl2_ct" style="text-align: center;" placeholder="City"
                              class="form-control border">
                            <input type="text" id="dl2_ln" style="text-align: center;" placeholder="Lic. no."
                              class="form-control border" minlength="6" maxlength="6">
                          </div>
                        </div>
                      </div>


                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="vendor_address">Address</label>
                        <div class="col-sm-10">
                          <div class="input-group input-group-merge">
                            <span class="input-group-text"></span>
                            <textarea type="text" id="vendor_address" class="form-control" placeholder=""
                              name="vendor_address"><%=vendor[0].vendor_address %></textarea>

                          </div>
                        </div>
                      </div>

                      <div class="row justify-content-end">
                        <div class="col-sm-10">
                          <button type="submit" id="submitbtn" class="btn btn-primary">Update</button>
                        </div>
                      </div>

                    </div>
                  </div>




                </div>
                <!-- / Content -->

                <div class="content-backdrop fade"></div>
              </div>
              <!-- Content wrapper -->
          </div>
          <!-- / Layout page -->
      </div>



      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>


    </div>
    <!-- / Layout wrapper -->

    <%- include('../partials/footercode.ejs') %>

      <script>



        var splitDL1;
        var dl_no_1 = "<%=vendor[0].vendor_dl_no_1%>";


        if (dl_no_1 != '') {

          splitDL1 = dl_no_1.split(/-/);
          $("#dl1_st").val(splitDL1[1]);
          $("#dl1_ct").val(splitDL1[2]);
          $("#dl1_ln").val(splitDL1[3]);
        }

        var splitDL2;
        var dl_no_2 = "<%=vendor[0].vendor_dl_no_2%>";
        if (dl_no_2 != '') {

          splitDL2 = dl_no_2.split(/-/);
          $("#dl2_st").val(splitDL2[1]);
          $("#dl2_ct").val(splitDL2[2]);
          $("#dl2_ln").val(splitDL2[3]);
        }
        $("#vendor_email").change(function () {
          var inputvalues = $(this).val();
          var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
          if (!regex.test(inputvalues)) {
            alert("invalid email id");
          }
        });


        $("#submitbtn").click(function () {
          if ($("#vendor_name").val() == '') {
            return alert('Please fill "Vendor Name"');
          }

          if ($("#vendor_contact").val().length < 10) {
            return alert('Please fill valid Phone number');
          }
          var vendor_dl_no_1 = $("#dl1_ft").val().toString() + '-' + $("#dl1_st").val().toString() + '-' + $("#dl1_ct").val().toString() + '-' + $("#dl1_ln").val().toString();
          var vendor_dl_no_2 = $("#dl2_ft").val().toString() + '-' + $("#dl2_st").val().toString() + '-' + $("#dl2_ct").val().toString() + '-' + $("#dl2_ln").val().toString();

          var vendorId = "<%= vendor[0].vendor_id %>";

          $.ajax({
            url: `/api/vendor/${vendorId}/update`,
            type: 'POST',
            data: JSON.stringify({
              vendor_name: $("#vendor_name").val(),
              vendor_address: $("#vendor_address").val(),
              vendor_contact: $("#vendor_contact").val(),
              vendor_gstin: $("#vendor_gstin").val(),
              vendor_email: $("#vendor_email").val(),
              vendor_dl_no_1: vendor_dl_no_1,
              vendor_dl_no_2: vendor_dl_no_2
            }),
            contentType: 'application/json',
            success: function (response) {
              window.location.href = '/vendor_list'
            },
            error: function (error) {
              console.log(error);
            }
          })
        })
      </script>
  </body>

  </html>