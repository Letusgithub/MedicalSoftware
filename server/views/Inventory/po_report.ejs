<%- include('../partials/headercode.ejs') %>

  <body>

    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar  ">
      <div class="layout-container">

        <!-- sidebar imported -->
        <%- include('../partials/sidebar.ejs') %>

          <!-- Layout container -->
          <div class="layout-page">

            <!-- navbar imported -->
            <%- include('../partials/navbar.ejs') %>

              <!-- Content wrapper -->
              <div class="content-wrapper">

                <!-- Content -->

                <div class="container-xxl flex-grow-1 container-p-y">

                  <h4 class="fw-bold py-3 mb-1"> Purchase Order Report</h4>
                  <hr class="mb-4">

                  <div class="row">

                    <div class="col-md-4">
                      <div class="card mb-4">
                        <h5 class="card-header">Monthly</h5>
                        <div class="card-body">
                          <div class="col-md-10">
                            <select class="form-select" id="selectmonth"
                              aria-label="Default select example">
                              <option selected>Please Select</option>
                              <option value="1">January</option>
                              <option value="2">February</option>
                              <option value="3">March</option>
                              <option value="4">April</option>
                              <option value="5">May</option>
                              <option value="6">June</option>
                              <option value="7">July</option>
                              <option value="8">August</option>
                              <option value="9">September</option>
                              <option value="10">October</option>
                              <option value="11">November</option>
                              <option value="12">December</option>

                            </select>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="card mb-4">
                        <h5 class="card-header">Quarterly</h5>
                        <div class="card-body">
                          <div>

                            <div class="col-md-10">
                              <select class="form-select" id="selectquarter"
                                aria-label="Default select example">
                                <option selected>Please Select</option>
                                <option value="1">April-June</option>
                                <option value="2">July-Sept</option>
                                <option value="3">Oct-Dec</option>
                                <option value="4">Jan-March</option>

                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="card mb-4">
                        <h5 class="card-header">Yearly</h5>
                        <div class="card-body">
                          <div class="col-md-10">
                            <select class="form-select" id="selectyear"
                              aria-label="Default select example">
                              <option selected>Please Select</option>
                              <!-- <option value="1">2022</option> -->
                              <option value="1">2023</option>

                            </select>
                          </div>
                        </div>
                      </div>
                    </div>



                    <h4 class="fw-bold py-3 mb-4">Custom Dates </h4>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="card mb-4">
                          <h5 class="card-header">From Date</h5>
                          <div class="card-body">
                            <div class="col-md-10">
                              <input class="form-control" type="date" id="html5-date-input" name="fromdate"/>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="card mb-4">
                          <h5 class="card-header">To Date</h5>
                          <div class="card-body">
                            <div>

                              <div class="col-md-10">
                                <input class="form-control" type="date" id="html5-date-input" name="todate"/>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>




                    <div class="text-center mb-4">
                      <button type="button" class="btn btn-primary" id="generatereport">Generate Report</button>
                    </div>

                    <!-- PO List -->
                    <div class="card mx-3">
                        <h5 class="card-header">PO List</h5>
                        <div class="card-body">
                            <div class="table-responsive text-nowrap">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>PO Id</th>
                                            <th>Generation Date</th>
                                            <th>Vendor Name</th>
                                            <!-- <th>Product</th>
                                            <th>Quantity</th> -->

                                        </tr>
                                    </thead>
                                    <tbody id="cartitems">
                                       

                                        <!-- <tr>
                                            <td>2</td>
                                            <td>19772</td>
                                            <td>20/03/2023</td>
                                            <th>Uday Aggarwal</th>
                                            <td>11/04/2023</td>
                                            <td><span class="badge bg-label-success me-1">Completed</span></td>
                                        </tr>

                                        <tr>
                                            <td>2</td>
                                            <td>17822</td>
                                            <td>26/03/2023</td>
                                            <th>Kartik Kondu</th>
                                            <td>25/04/2023</td>
                                            <td><span class="badge bg-label-warning me-1">Pending</span></td>
                                        </tr> -->

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- / PO List -->



                  </div>
                </div>
                <!-- / Content -->
                
                <div class="content-backdrop fade"></div>
              </div>
              <!-- Content wrapper -->
          </div>
          <!-- / Layout page -->
      </div>



      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>


    </div>
    <!-- / Layout wrapper -->

    <%- include('../partials/footercode.ejs') %>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script>
      var fromDate;
      var toDate;

      $(document).ready(function(){
    
        $('#selectmonth').change(function(){
          var month = $(this).val();
          $.get(`/api/searchmonthpo?org=<%=orgId%>&month=${month}`, function(data, status){
            $("#reportcart").empty();
            var items = data.data;
            console.log(items);
            for(let i=0;i<items.length;i++){

                var datetime = items[i].po_created_date; 
                var date = moment(datetime).format('DD MMMM YYYY');
                var time = moment(datetime).utcOffset('+05:30');
                var localTime = time.format('hh:mm A');
              var htmlData = `

              <tr>
                <td>${i+1}</td>
                <td><a href="/po_receipt/${items[i].po_id}" >${items[i].po_id_main}</a></td>
                <td>${date}</td>
                <th>${items[i].vendor_name}</th>
            </tr>
              
              `
              $("#cartitems").append(htmlData);
              
            }
          })
        })

        $('#selectquarter').change(function(){
          var quarter = $(this).val();
          $.get(`/api/searchquarterpo?org=<%=orgId%>&quarter=${quarter}`, function(data, status){
            $("#reportcart").empty();
            var items = data.data;
            console.log(items);
            for(let i=0;i<items.length;i++){

               
              var datetime = items[i].po_created_date; 
              var date = moment(datetime).format('DD MMMM YYYY');
              var time = moment(datetime).utcOffset('+05:30');
              var localTime = time.format('hh:mm A');
              var htmlData = `
              <tr>
                <td>${i+1}</td>
                <td><a href="/po_receipt/${items[i].po_id}" >${items[i].po_id_main}</a></td>
                <td>${date}</td>
                <th>${items[i].vendor_name}</th>
            </tr>
              
              `
              $("#cartitems").append(htmlData);
              
            }
          })
        })

        $('#selectyear').change(function(){
          var year = $(this).find('option:selected').text();
          console.log(year);
          $.get(`/api/searchyearpo?org=<%=orgId%>&year=${year}`, function(data, status){
            $("#reportcart").empty();
            var items = data.data;
            console.log(items);
            for(let i=0;i<items.length;i++){

              var datetime = items[i].po_created_date; 
              var date = moment(datetime).format('DD MMMM YYYY');
              var time = moment(datetime).utcOffset('+05:30');
              var localTime = time.format('hh:mm A');
              var htmlData = `
              <tr>
                <td>${i+1}</td>
                <td><a href="/po_receipt/${items[i].po_id}" >${items[i].po_id_main}</a></td>
                <td>${date}</td>
                <th>${items[i].vendor_name}</th>
            </tr>
              
              `
              $("#cartitems").append(htmlData);
              
            }
          })
        })



        $("#generatereport").click(function(){
          var fromDate = $("input[name='fromdate']").val();
          var toDate = $("input[name='todate']").val();
          
          $.get(`/api/searchdatespo?org=<%=orgId%>&from=${fromDate}&to=${toDate}`, function(data, status){
            $("#reportcart").empty();
            var items = data.data;
            console.log(items);
            for(let i=0;i<items.length;i++){

              var datetime = items[i].po_created_date; 
              var date = moment(datetime).format('DD MMMM YYYY');
              var time = moment(datetime).utcOffset('+05:30');
              var localTime = time.format('hh:mm A');
              var htmlData = `
              <tr>
                <td>${i+1}</td>
                <td><a href="/po_receipt/${items[i].po_id}" >${items[i].po_id_main}</a></td>
                <td>${date}</td>
                <th>${items[i].vendor_name}</th>
            </tr>
              
              `
              $("#cartitems").append(htmlData);
              
            }
          })
        })
      
      
      
      
      
      
      
      
      
      
      
      
      })
    </script>

  </body>


  </html>