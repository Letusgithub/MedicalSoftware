<%- include('../partials/headercode.ejs') %>

  <body>

    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar  ">
      <div class="layout-container">

        <!-- sidebar imported -->
        <%- include('../partials/sidebar.ejs') %>

          <!-- Layout container -->
          <div class="layout-page">

            <!-- navbar imported -->
            <%- include('../partials/navbar.ejs') %>

              <!-- Content wrapper -->
              <div class="content-wrapper">

                <!-- Content -->

                <div class="container-xxl flex-grow-1 container-p-y">

                  <h4 class="fw-bold py-3 mb-1"> Purchase Order Report</h4>
                  <hr class="mb-4">


                  <!--  -->
                  <div>
                    <div class="card mb-4">
                      <div class="row align-items-center flex ">
                        <div class="col-md-2  text-center">
                          <!-- <div class="card-header mb-2">From Date</div> -->
                          <h5 class="card-header mb-2">From Date</h5>
                        </div>
                        <div class="col-md-4 ">
                          <div class="card-header">
                            <input class="form-control" type="date" id="html5-date-input" name="fromdate" />
                          </div>
                        </div>
                        <div class="col-md-2 text-center">
                          <h5 class="card-header mb-2">To Date</h5>
                        </div>
                        <div class="col-md-4 ">
                          <div class="card-header">
                            <input class="form-control" type="date" id="html5-date-input" name="todate" />
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card mb-4">
                      <div class="row">
                        <div class="col-md-4 text-center">
                          <h5 class="card-header"><input type="radio" name="radio" value="monthly"> Monthly</h5>
                        </div>
                        <div class="col-md-4 text-center">
                          <h5 class="card-header"><input type="radio" name="radio" value="quarterly"> Quarterly</h5>
                        </div>
                        <div class="col-md-4 text-center">
                          <h5 class="card-header"><input type="radio" name="radio" value="yearly"> Yearly</h5>
                        </div>
                      </div>

                      <div id="dropdown"></div>
                    </div>

                  </div>


                  <!--  -->
                  <div class="text-center mb-4">
                    <button type="button" class="btn btn-primary" id="generatereport">Generate Report</button>
                  </div>

                  <!-- PO List -->
                  <div class="card mx-3">
                    <h5 class="card-header">PO List</h5>
                    <div class="card-body">
                      <div class="table-responsive text-nowrap">
                        <table class="table table-bordered">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>PO Id</th>
                              <th>Generation Date</th>
                              <th>Time</th>
                              <th>Vendor Name</th>
                              <!-- <th>Product</th>
                                            <th>Quantity</th> -->

                            </tr>
                          </thead>
                          <tbody id="reportcart">


                            <!-- <tr>
                                            <td>2</td>
                                            <td>19772</td>
                                            <td>20/03/2023</td>
                                            <th>Uday Aggarwal</th>
                                            <td>11/04/2023</td>
                                            <td><span class="badge bg-label-success me-1">Completed</span></td>
                                        </tr>

                                        <tr>
                                            <td>2</td>
                                            <td>17822</td>
                                            <td>26/03/2023</td>
                                            <th>Kartik Kondu</th>
                                            <td>25/04/2023</td>
                                            <td><span class="badge bg-label-warning me-1">Pending</span></td>
                                        </tr> -->

                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>

                  <!-- / PO List -->

                </div>
              </div>
              <!-- / Content -->

              <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
      </div>
      <!-- / Layout page -->
    </div>



    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>


    </div>
    <!-- / Layout wrapper -->

    <%- include('../partials/footercode.ejs') %>
      <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
      <script>
        var fromDate;
        var toDate;

        $(document).ready(function () {

          $('input[name="radio"][value="monthly"]').on('click', function () {
            // Clear previous inputs
            $("input[name='fromdate']").val('');
            $("input[name='todate']").val('');
            $("#reportcart").empty();

            if ($(this).is(':checked')) {
              $("#dropdown").html(`
                  <div class="card-body">
                      <div class="row justify-content-center">
                            <div class="col-md-6 col-12  text-center mb-2">
                                <select class="form-select" id="selectmonth" aria-label="Default select example">
                                    <option selected value="">Please Select</option>
                                    <option value="1">January</option>
                                    <option value="2">February</option>
                                    <option value="3">March</option>
                                    <option value="4">April</option>
                                    <option value="5">May</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="8">August</option>
                                    <option value="9">September</option>
                                    <option value="10">October</option>
                                    <option value="11">November</option>
                                    <option value="12">December</option>
                                </select>
                            </div> 
                            <div class="col-md-6 col-12  text-center mb-2">
                                <select class="form-select" id="month-selectyear" aria-label="Default select example">
                                    <option selected value="">Please Select</option>
                                    <option value="2022">2022</option>
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                </select>
                            </div>
                      </div>    
                  </div>
              `);
            }
          });

          $('input[name="radio"][value="quarterly"]').on('click', function () {
            // Clear previous inputs
            $("input[name='fromdate']").val('');
            $("input[name='todate']").val('');
            $("#reportcart").empty();

            if ($(this).is(':checked')) {
              $("#dropdown").html(`
              <div class="card-body">
                    <div class="row justify-content-center">
                        <div class="col-md-6 col-12  text-center mb-2">
                            <select class="form-select" id="selectquarter" aria-label="Default select example">
                                <option selected>Please Select</option>
                                <option value="1">April-June</option>
                                <option value="2">July-Sept</option>
                                <option value="3">Oct-Dec</option>
                                <option value="4">Jan-March</option>
                            </select>
                        </div>
                        <div class="col-md-6 col-12 text-center mb-2">
                            <select class="form-select" id="quarter-selectyear" aria-label="Default select example" >
                                <option selected value="">Please Select</option>
                                <option value="2022">2022</option>
                                <option value="2023">2023</option>
                                <option value="2024">2024</option>
                            </select>
                        </div>
                    </div>
                </div>
              `);
            }

          });

          $('input[name="radio"][value="yearly"]').on('click', function () {
            // Clear previous inputs
            $("input[name='fromdate']").val('');
            $("input[name='todate']").val('');
            $("#reportcart").empty();

            if ($(this).is(':checked')) {
              $("#dropdown").html(`
                  <div class="card-body ">
                        <div class="col-md-12 text-center mb-2">
                            <select class="form-select" id="selectyear" aria-label="Default select example" style="width: 100%;">
                                <option selected value="">Please Select</option>
                                <option value="2022">2022</option>
                                <option value="2023">2023</option>
                                <option value="2024">2024</option>
                            </select>
                        </div>
                  </div>
              `);
            }
          });

          $("#dropdown_month .card-body, #dropdown_quarter .card-body, #dropdown_year .card-body").hide();
          $('input[name="radio"]').on('click', function () {
            var value = $(this).val();

            // Hide the card-body elements of all dropdowns

            $("#dropdown_month .card-body, #dropdown_quarter .card-body, #dropdown_year .card-body").hide();
            // Show the corresponding dropdown's card-body based on the selected radio button

          });

          $(document).on('change', '#selectmonth, #month-selectyear', function () {
            var month = $("#selectmonth").val();
            var year = $("#month-selectyear").val();

            $.get(`/api/searchmonthpo?org=<%=orgId%>&month=${month}&year=${year}`, function (data, status) {
              $("#reportcart").empty();
              var items = data.data;
              console.log(items);
              for (let i = 0; i < items.length; i++) {

                var datetime = items[i].po_created_date;
                var date = moment(datetime).format('DD MMMM YYYY');
                var time = moment(datetime).utcOffset('+05:30');
                var localTime = time.format('hh:mm A');
                var htmlData = `

                  <tr>
                    <td>${i + 1}</td>
                    <td><a href="/po_receipt/${items[i].po_id}" >${items[i].po_id_main}</a></td>
                    <td>${date}</td>
                    <td>${localTime}</td>
                    <th>${items[i].vendor_name}</th>
                  </tr>`
                $("#reportcart").append(htmlData);

              }
            })
          })

          $(document).on('change', '#selectquarter, #quarter-selectyear', function () {
            var quarter = $("#selectquarter").val();
            var year = $("#quarter-selectyear").val();

            $.get(`/api/searchquarterpo?org=<%=orgId%>&quarter=${quarter}&year=${year}`, function (data, status) {
              $("#reportcart").empty();
              var items = data.data;
              console.log(items);
              for (let i = 0; i < items.length; i++) {
                var datetime = items[i].po_created_date;
                var date = moment(datetime).format('DD MMMM YYYY');
                var time = moment(datetime).utcOffset('+05:30');
                var localTime = time.format('hh:mm A');
                var htmlData = `
              <tr>
                <td>${i + 1}</td>
                <td><a href="/po_receipt/${items[i].po_id}" >${items[i].po_id_main}</a></td>
                <td>${date}</td>
                <td>${localTime}</td>
                <th>${items[i].vendor_name}</th>
            </tr>
              
              `
                $("#reportcart").append(htmlData);

              }
            })
          })

          $(document).on('change', '#selectyear', function () {
            var year = $("#selectyear").val();
            
            $.get(`/api/searchyearpo?org=<%=orgId%>&year=${year}`, function (data, status) {
              $("#reportcart").empty();
              var items = data.data;
              console.log(items);
              for (let i = 0; i < items.length; i++) {

                var datetime = items[i].po_created_date;
                var date = moment(datetime).format('DD MMMM YYYY');
                var time = moment(datetime).utcOffset('+05:30');
                var localTime = time.format('hh:mm A');
                var htmlData = `
                  <tr>
                    <td>${i + 1}</td>
                    <td><a href="/po_receipt/${items[i].po_id}" >${items[i].po_id_main}</a></td>
                    <td>${date}</td>
                    <td>${localTime}</td>
                    <th>${items[i].vendor_name}</th>
                  </tr>`
                $("#reportcart").append(htmlData);

              }
            })
          })



          $("#generatereport").click(function () {
            var fromDate = $("input[name='fromdate']").val();
            var toDate = $("input[name='todate']").val();

            $.get(`/api/searchdatespo?org=<%=orgId%>&from=${fromDate}&to=${toDate}`, function (data, status) {
              $("#reportcart").empty();
              var items = data.data;
              console.log(items);
              for (let i = 0; i < items.length; i++) {

                var datetime = items[i].po_created_date;
                var date = moment(datetime).format('DD MMMM YYYY');
                var time = moment(datetime).utcOffset('+05:30');
                var localTime = time.format('hh:mm A');
                var htmlData = `
              <tr>
                <td>${i + 1}</td>
                <td><a href="/po_receipt/${items[i].po_id}" >${items[i].po_id_main}</a></td>
                <td>${date}</td>
                <td>${localTime}</td>
                <th>${items[i].vendor_name}</th>
            </tr>
              
              `
                $("#reportcart").append(htmlData);

              }
            })
          })
        })
      </script>

      <style>
        @media (max-width: 767px) {

          .card-body.d-flex .row.w-100 {
            flex-direction: row;
            /* Ensure row direction */
            justify-content: start;
            /* Center the content */
            align-items: flex-start;
          }

          .col-6 {
            flex: 0 0 50%;
            /* Make each input take up 50% of the width */
            max-width: 50%;

          }

          .text-center select {
            width: 100%;
            /* Ensure the select input takes full width */
          }

          .card-header {
            font-size: 0.75em;
            /* Adjust the font size as needed */
            display: flex;
            justify-content: flex-start;
            /* Align content to the left */
            align-items: flex-start;
            padding: 10px;
          }

          .card-header input {
            margin-right: 0.5rem;
          }
        }
      </style>

  </body>


  </html>