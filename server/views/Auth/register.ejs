<%- include('../partials/headercode.ejs') %>

    <body>

        <!-- Content -->


        <div class="authentication-wrapper authentication-cover">
            <div class="authentication-inner row m-0">

                <!-- Left Text -->
                <div class="d-none d-lg-flex col-lg-4 align-items-center justify-content-end p-5 pe-0">
                    <div class="w-px-400">
                        <img src="/img/backgrounds/create-account-light.png" class="img-fluid" alt="multi-steps"
                            width="600" data-app-dark-img="illustrations/create-account-dark.png"
                            data-app-light-img="illustrations/create-account-light.html">
                    </div>
                </div>
                <!-- /Left Text -->

                <!--  Multi Steps Registration -->
                <div class="d-flex col-lg-8 align-items-center justify-content-center authentication-bg p-sm-5 p-3">
                    <div class="w-px-700">
                        <div id="multiStepsValidation" class="bs-stepper shadow-none">

                            <div class="bs-stepper-content">

                                <!-- Personal Info -->
                                <div id="pharmacyDetails" class="content">
                                    <div class="content-header mb-3">
                                        <h3 class="mb-2">Register Your Pharmacy</h3>
                                        <span>Enter Your Pharmacy Details</span>
                                    </div>
                                    <div class="row g-3 d-flex justify-content-center">
                                        <div class="col-sm-10">
                                            <label class="form-label" for="org_name">Pharmacy name</label>
                                            <input type="text" id="org_name" name="org_name" class="form-control"
                                                required />
                                        </div>
                                        <div class="col-sm-10">
                                            <label class="form-label" for="owner_name">Owner name</label>
                                            <input type="text" id="owner_name" name="owner_name" class="form-control"
                                                required />
                                        </div>
                                        <div class="col-sm-10">
                                            <label class="form-label" for="org_dl_no_1">DL No. 1</label>
                                            <div class="input-group">
                                                <span id="basic-icon-default-fullname2" class="input-group-text"><i
                                                        class='bx bx-detail'></i></span>
                                                <input type="text" id="dl1_ft" value="20" class="form-control" readonly>
                                                <select type="text" id="dl1_st" placeholder="State"
                                                    class="form-control">
                                                    <option selected> State</option>
                                                    <option value="AD">Andhra Pradesh</option>
                                                    <option value="AR"> Arunachal Pradesh</option>
                                                    <option value="AS"> Assam</option>
                                                    <option value="BR"> Bihar</option>
                                                    <option value="CG"> Chattisgarh</option>
                                                    <option value="DL"> Delhi</option>
                                                    <option value="GA"> Goa</option>
                                                    <option value="GJ"> Gujarat</option>
                                                    <option value="HR"> Haryana</option>
                                                    <option value="HP"> Himachal Pradesh</option>
                                                    <option value="JK"> Jammu and Kashmir</option>
                                                    <option value="JH"> Jharkhand</option>
                                                    <option value="KA"> Karnataka</option>
                                                    <option value="KL"> Kerala</option>
                                                    <option value="LD"> Lakshadweep Islands</option>
                                                    <option value="MP"> Madhya Pradesh</option>
                                                    <option value="MH"> Maharashtra</option>
                                                    <option value="MN"> Manipur</option>
                                                    <option value="ML"> Meghalaya</option>
                                                    <option value="MZ"> Mizoram</option>
                                                    <option value="NL"> Nagaland</option>
                                                    <option value="OD"> Odisha</option>
                                                    <option value="PY"> Pondicherry</option>
                                                    <option value="PB"> Punjab</option>
                                                    <option value="RJ"> Rajasthan</option>
                                                    <option value="SK"> Sikkim</option>
                                                    <option value="TN"> Tamil Nadu</option>
                                                    <option value="TS"> Telangana</option>
                                                    <option value="TR"> Tripura</option>
                                                    <option value="UP"> Uttar Pradesh</option>
                                                    <option value="UK"> Uttarakhand</option>
                                                    <option value="WB"> West Bengal</option>
                                                </select>
                                                <input type="text" id="dl1_ct" placeholder="City (eg:-NG)"
                                                    class="form-control">
                                                <input type="text" id="dl1_ln" placeholder="License No."
                                                    class="form-control" minlength="6" maxlength="6">
                                            </div>
                                        </div>
                                        <div class="col-sm-10">
                                            <label class="form-label" for="org_dl_no_2">DL No. 2</label>
                                            <div class="input-group">
                                                <span id="basic-icon-default-fullname2" class="input-group-text"><i
                                                        class='bx bx-detail'></i></span>
                                                <input type="text" id="dl2_ft" value="21" class="form-control" readonly>
                                                <select type="text" id="dl2_st"
                                                    class="form-control">
                                                    <option selected> State</option>
                                                    <option value="AD">Andhra Pradesh</option>
                                                    <option value="AR"> Arunachal Pradesh</option>
                                                    <option value="AS"> Assam</option>
                                                    <option value="BR"> Bihar</option>
                                                    <option value="CG"> Chattisgarh</option>
                                                    <option value="DL"> Delhi</option>
                                                    <option value="GA"> Goa</option>
                                                    <option value="GJ"> Gujarat</option>
                                                    <option value="HR"> Haryana</option>
                                                    <option value="HP"> Himachal Pradesh</option>
                                                    <option value="JK"> Jammu and Kashmir</option>
                                                    <option value="JH"> Jharkhand</option>
                                                    <option value="KA"> Karnataka</option>
                                                    <option value="KL"> Kerala</option>
                                                    <option value="LD"> Lakshadweep Islands</option>
                                                    <option value="MP"> Madhya Pradesh</option>
                                                    <option value="MH"> Maharashtra</option>
                                                    <option value="MN"> Manipur</option>
                                                    <option value="ML"> Meghalaya</option>
                                                    <option value="MZ"> Mizoram</option>
                                                    <option value="NL"> Nagaland</option>
                                                    <option value="OD"> Odisha</option>
                                                    <option value="PY"> Pondicherry</option>
                                                    <option value="PB"> Punjab</option>
                                                    <option value="RJ"> Rajasthan</option>
                                                    <option value="SK"> Sikkim</option>
                                                    <option value="TN"> Tamil Nadu</option>
                                                    <option value="TS"> Telangana</option>
                                                    <option value="TR"> Tripura</option>
                                                    <option value="UP"> Uttar Pradesh</option>
                                                    <option value="UK"> Uttarakhand</option>
                                                    <option value="WB"> West Bengal</option>
                                                </select>
                                                <input type="text" id="dl2_ct" placeholder="City (eg:-NG)"
                                                    class="form-control">
                                                <input type="text" id="dl2_ln" placeholder="License No."
                                                    class="form-control" minlength="6" maxlength="6">
                                            </div>
                                        </div>
                                        <div class="col-sm-10">
                                            <label class="form-label" for="org_pincode">Pincode</label>
                                            <input type="number" id="org_pincode" name="org_pincode"
                                                class="form-control" />
                                        </div>
                                        <div class="col-sm-10">
                                            <label class="form-label" for="org_address">Address</label>
                                            <textarea type="text" id="org_address" name="org_address"
                                                class="form-control" required>
                                                </textarea>
                                        </div>

                                        <div class="col-sm-10">
                                            <div class="form-check mt-3">
                                                <input class="form-check-input" type="checkbox" value=""
                                                    id="defaultCheck1" checked />
                                                <label class="form-check-label" for="defaultCheck1">
                                                    Disclaimer : Hereby I assure that data given here is
                                                    validated by me and is genuine to my consiousness as this data
                                                    cannot be edited further.
                                                </label>
                                            </div>
                                        </div>

                                        <div class="col-sm-4 text-center my-4">
                                            <button class="btn btn-primary btn-next w-100"
                                                id="submitPharmacyDetails">Confirm</button>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- / Multi Steps Registration -->
            </div>
        </div>

        <!-- / Content -->



        <%- include('../partials/footercode.ejs') %>

            <!-- Page JS -->
            <script src="/js/pages-auth.js"></script>
            <script src="/js/pages-auth-two-steps.js"></script>

            <script>
                $(document).ready(function () {

                    $("#dl2_ln").on('input', function () {
                        if ($("#dl1_ln").val() == $("#dl2_ln").val()) {
                            $("#dl2_ln").val(null);
                            return alert(" DL Number 1  and DL Number 2 cannot be same");
                        }
                    });


                    var city;
                    var state;

                    $("#org_pincode").on('input', function(){

                        var pin = $("#org_pincode").val();

                        if(pin.length > 6){
                            return alert("Enter correct 6-digit Pincode")
                        }
                        if(pin.length == 6){
                            $.get("https://api.postalpincode.in/pincode/" + pin, function(response){
                                if (response[0].PostOffice === null){
                                    return alert("Invalid Pincode")
                                }
                                city = response[0].PostOffice[0].Block;
                                state = response[0].PostOffice[0].State
 
                            })
                            
                        }
                        
                    })
                                       

                    $("#submitPharmacyDetails").click(function () {
                        var dl_no_1 = $("#dl1_ft").val().toString() + '-' + $("#dl1_st").val().toString() + '-' + $("#dl1_ct").val().toString() + '-' + $("#dl1_ln").val().toString();
                        var dl_no_2 = $("#dl2_ft").val().toString() + '-' + $("#dl2_st").val().toString() + '-' + $("#dl2_ct").val().toString() + '-' + $("#dl2_ln").val().toString();

                        if ($("#org_name").val() && $("#owner_name").val() && dl_no_1 && dl_no_2 && $("#org_pincode").val() && $("#org_address").val()) {
                            
                            $.ajax({
                                url: `/api/auth/register`,
                                type: 'POST',
                                data: JSON.stringify({
                                    org_telephone: '<%= mobileNumber %>',
                                    org_name: $("#org_name").val(),
                                    owner_name: $("#owner_name").val(),
                                    org_dl_no_1: dl_no_1,
                                    org_dl_no_2: dl_no_2,
                                    org_pincode: $("#org_pincode").val(),
                                    org_address: $("#org_address").val(),
                                    org_city: city,
                                    org_state: state
                                }),
                                contentType: 'application/json',
                                success: function (response) {
                                    window.location.href = response.redirect
                                },
                                error: function (error) {
                                    console.log('error', error);
                                }
                            })
                        }
                        else {
                            alert("Please fill all inputs")
                        }


                    })

                })
            </script>


    </body>

    </html>