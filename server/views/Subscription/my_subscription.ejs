<%- include('../partials/headercode.ejs') %>

    <body>

        <!-- Layout wrapper -->
        <div class="layout-wrapper layout-content-navbar  ">
            <div class="layout-container">

                <!-- sidebar imported -->
                <%- include('../partials/sidebar.ejs') %>

                    <!-- Layout container -->
                    <div class="layout-page">

                        <!-- navbar imported -->
                        <%- include('../partials/navbar.ejs') %>

                            <!-- Content wrapper -->
                            <div class="content-wrapper">

                                <!-- Content -->

                                <div class="container-xxl flex-grow-1 container-p-y">


                                    <h4 class="py-3 mb-4">
                                        My Subscription
                                    </h4>

                                    <div class="row">
                                        <div class="col-md-12">

                                            <div class="card mb-4">
                                                <!-- Current Plan -->
                                                <h5 class="card-header">Current Plan</h5>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-6 mb-1">
                                                            <div class="mb-4">
                                                                <h6 class="mb-2">Your Current Plan is <span
                                                                        id="plan_name"></span></h6>
                                                                <p>A simple start for everyone</p>
                                                            </div>
                                                            <div class="mb-4">
                                                                <h6 class="mb-2">Active until <span
                                                                        id="plan_expiry"></span></h6>
                                                                <p>We will send you a notification upon Subscription
                                                                    expiration</p>
                                                            </div>

                                                        </div>
                                                        <div class="col-md-6 mb-1">
                                                            <div class="alert alert-warning mb-4" role="alert">
                                                                <h6 class="alert-heading mb-1">We need your attention!
                                                                </h6>
                                                                <span>Your plan requires update</span>
                                                            </div>
                                                            <div class="plan-statistics">
                                                                <div class="d-flex justify-content-between">
                                                                    <span class="fw-medium mb-2">Days</span>
                                                                    <span class="fw-medium mb-2"><span id="remaining_days"></span> of <span id="plan_duration"></span> Days</span>
                                                                </div>
                                                                <div class="progress">
                                                                    <div class="progress-bar" role="progressbar"
                                                                        aria-valuenow="20" aria-valuemin="0"
                                                                        aria-valuemax="100">
                                                                    </div>
                                                                </div>
                                                                <!-- <p class="mt-1 mb-0">6 days remaining until your plan
                                                                    requires
                                                                    update</p> -->
                                                            </div>
                                                        </div>
                                                        <div class="col-12">
                                                            <button class="btn btn-primary me-2 mt-2"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#pricingModal">Upgrade Plan</button>
                                                            <button
                                                                class="btn btn-label-secondary cancel-subscription mt-2">Cancel
                                                                Subscription</button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- /Current Plan -->
                                            </div>

                                            <div class="card mb-4">
                                                <!-- Billing Address -->
                                                <h5 class="card-header">Billing Address</h5>
                                                <div class="card-body">
                                                    <form id="formAccountSettings" onsubmit="return false">
                                                        <div class="row">
                                                            <div class="mb-3 col-sm-6">
                                                                <label for="companyName" class="form-label">Company
                                                                    Name</label>
                                                                <input type="text" id="companyName" name="companyName"
                                                                    class="form-control" placeholder="Pharmacy name" />
                                                            </div>
                                                            <div class="mb-3 col-sm-6">
                                                                <label for="billingEmail" class="form-label">Billing
                                                                    Email</label>
                                                                <input class="form-control" type="text"
                                                                    id="billingEmail" name="billingEmail"
                                                                    placeholder="user@example.com" />
                                                            </div>
                                                            <div class="mb-3 col-sm-6">
                                                                <label for="vatNumber" class="form-label">GSTIN</label>
                                                                <input class="form-control" type="text" id="vatNumber"
                                                                    name="vatNumber" placeholder="Enter GSTIN" />
                                                            </div>
                                                            <div class="mb-3 col-sm-6">
                                                                <label for="mobileNumber"
                                                                    class="form-label">Mobile</label>
                                                                <div class="input-group input-group-merge">
                                                                    <span class="input-group-text">IND (+91)</span>
                                                                    <input class="form-control mobile-number"
                                                                        type="text" id="mobileNumber"
                                                                        name="mobileNumber"
                                                                        placeholder="902 555 0111" />
                                                                </div>
                                                            </div>
                                                            <div class="mb-3 col-12">
                                                                <label for="billingAddress" class="form-label">Billing
                                                                    Address</label>
                                                                <input type="text" class="form-control"
                                                                    id="billingAddress" name="billingAddress"
                                                                    placeholder="Billing Address" />
                                                            </div>
                                                            <div class="mb-3 col-sm-6">
                                                                <label for="state" class="form-label">State</label>
                                                                <input class="form-control" type="text" id="state"
                                                                    name="state" placeholder="Maharashtra" />
                                                            </div>
                                                            <div class="mb-3 col-sm-6">
                                                                <label for="zipCode" class="form-label">Pin Code</label>
                                                                <input type="text" class="form-control zip-code"
                                                                    id="zipCode" name="zipCode" placeholder="231465"
                                                                    maxlength="6" />
                                                            </div>
                                                        </div>
                                                        <div class="mt-2">
                                                            <button type="submit" class="btn btn-primary me-2">Save
                                                                changes</button>
                                                            <button type="reset"
                                                                class="btn btn-label-secondary">Discard</button>
                                                        </div>
                                                    </form>
                                                </div>
                                                <!-- /Billing Address -->
                                            </div>
                                            <div class="card">
                                                <!-- Billing History -->
                                                <h5 class="card-header border-bottom">Billing History</h5>
                                                <div class="card-datatable table-responsive">
                                                    <table class="invoice-list-table table border-top">
                                                        <thead>
                                                            <tr>
                                                                <th></th>
                                                                <th>#ID</th>
                                                                <th><i class='bx bx-trending-up'></i></th>
                                                                <th>Client</th>
                                                                <th>Total</th>
                                                                <th class="text-truncate">Issued Date</th>
                                                                <th>Balance</th>
                                                                <th>Invoice Status</th>
                                                                <th class="cell-fit">Actions</th>
                                                            </tr>
                                                        </thead>
                                                    </table>
                                                </div>
                                                <!--/ Billing History -->
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Modal -->
                                    <!-- Pricing Modal -->
                                    <div class="modal fade" id="pricingModal" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog modal-xl modal-simple modal-pricing">
                                            <div class="modal-content p-0 p-md-2 p-xl-5">
                                                <div class="modal-body px-2 px-md-4">
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                                    <!-- Pricing Plans -->
                                                    <div class="rounded-top">
                                                        <h2 class="text-center mb-2 mt-0 mt-md-4 px-2">Find the right
                                                            plan
                                                            for your
                                                            site</h2>
                                                        <p class="text-center pb-3 px-2"> Get started with us - it's
                                                            perfect
                                                            for
                                                            individuals and teams. Choose a subscription plan that meets
                                                            your needs.
                                                        </p>

                                                        <!-- All Plans -->
                                                        <div class="row mx-0 gy-3">

                                                            <!-- Basic -->
                                                            <div class="col-lg mb-md-0 mb-4">
                                                                <div class="card border rounded shadow-none">
                                                                    <div class="card-body position-relative">
                                                                        <div class="my-3 pt-2 text-center">
                                                                            <img src="/img/icons/unicons/bookmark.png"
                                                                                alt="Starter Image" height="80">
                                                                        </div>
                                                                        <h3
                                                                            class="card-title text-center text-capitalize mb-1">
                                                                            Free Plan</h3>
                                                                        <p class="text-center">First 30 Days free trial
                                                                            plan
                                                                        </p>
                                                                        <div class="text-center">
                                                                            <div class="d-flex justify-content-center">
                                                                                <sup
                                                                                    class="h6 pricing-currency mt-3 mb-0 me-1 text-primary">₹</sup>
                                                                                <h1 class="display-4 mb-0 text-primary">
                                                                                    0
                                                                                </h1>
                                                                            </div>
                                                                        </div>

                                                                        <button type="button"
                                                                            class="btn btn-primary d-grid w-100"
                                                                            id="freePlanBtn"
                                                                            data-bs-dismiss="modal">Subscribe</button>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <!-- Pro -->
                                                            <div class="col-lg mb-md-0 mb-4">
                                                                <div class="card border-primary border shadow-none">
                                                                    <div class="card-body position-relative">
                                                                        <div
                                                                            class="position-absolute end-0 me-4 top-0 mt-4">
                                                                            <span
                                                                                class="badge bg-label-primary">Popular</span>
                                                                        </div>
                                                                        <div class="my-3 pt-2 text-center">
                                                                            <img src="/img/icons/unicons/wallet-round.png"
                                                                                alt="Pro Image" height="80">
                                                                        </div>
                                                                        <h3
                                                                            class="card-title text-center text-capitalize mb-1">
                                                                            Silver Plan
                                                                        </h3>
                                                                        <p class="text-center">90 Days plan</p>
                                                                        <div class="text-center">
                                                                            <div class="d-flex justify-content-center">
                                                                                <sup
                                                                                    class="h6 pricing-currency mt-3 mb-0 me-1 text-primary">₹</sup>
                                                                                <h1
                                                                                    class="price-toggle price-yearly display-4 text-primary mb-0">
                                                                                    1500</h1>
                                                                            </div>
                                                                        </div>

                                                                        <button type="button"
                                                                            class="btn btn-primary d-grid w-100"
                                                                            id="silverPlanBtn"
                                                                            data-bs-dismiss="modal">Subscribe</button>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <!-- Enterprise -->
                                                            <div class="col-lg">
                                                                <div class="card border rounded shadow-none">
                                                                    <div class="card-body">

                                                                        <div class="my-3 pt-2 text-center">
                                                                            <img src="/img/icons/unicons/briefcase-round.png"
                                                                                alt="Pro Image" height="80">
                                                                        </div>
                                                                        <h3
                                                                            class="card-title text-center text-capitalize mb-1">
                                                                            Gold Plan</h3>
                                                                        <p class="text-center">6 month plan</p>

                                                                        <div class="text-center">
                                                                            <div class="d-flex justify-content-center">
                                                                                <sup
                                                                                    class="h6 text-primary pricing-currency mt-3 mb-0 me-1">₹</sup>
                                                                                <h1
                                                                                    class="price-toggle price-yearly display-4 text-primary mb-0">
                                                                                    2700</h1>
                                                                            </div>
                                                                        </div>

                                                                        <button type="button"
                                                                            class="btn btn-primary d-grid w-100"
                                                                            id="goldPlanBtn"
                                                                            data-bs-dismiss="modal">Subscribe</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--/ Pricing Plans -->
                                            </div>
                                        </div>
                                    </div>
                                    <!--/ Pricing Modal -->

                                    <!--/ Modal -->


                                </div>
                                <!-- / Content -->






                                <div class="content-backdrop fade"></div>
                            </div>
                            <!-- Content wrapper -->
                    </div>
                    <!-- / Layout page -->
            </div>

            <!-- Overlay -->
            <div class="layout-overlay layout-menu-toggle"></div>


            <!-- Drag Target Area To SlideIn Menu On Small Screens -->
            <div class="drag-target"></div>

        </div>
        <!-- / Layout wrapper -->

        <%- include('../partials/footercode.ejs') %>

            <script>
                $(document).ready(function () {

                    $.get('/api/subscription/currentplan/<%=orgId%>', function (data) {
                        console.log(data)
                        $('#plan_name').text(data.data[0].plan_name);

                        let current_date = new Date();
                        let plan_end = new Date(data.data[0].plan_end);
                        let formattedDate = plan_end.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                        $('#plan_expiry').text(formattedDate);

                        let plan_duration = data.data[0].duration;
                        console.log(plan_duration)
                        $('#plan_duration').text(plan_duration);


                        let remaining_days = ((plan_end - current_date) / (1000 * 60 * 60 * 24));
                        $('#remaining_days').text(Math.floor(remaining_days));

                        let percentage = Math.floor((remaining_days / plan_duration ) * 100);

                        $('.progress-bar').css('width', percentage + '%').attr('aria-valuenow', percentage);

                    });

                    // Cancel Subscription
                    $('.cancel-subscription').on('click', function () {
                        Swal.fire({
                            title: 'Are you sure?',
                            text: "You won't be able to revert this!",
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Yes, cancel it!'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                Swal.fire(
                                    'Cancelled!',
                                    'Your subscription has been cancelled.',
                                    'success'
                                )
                            }
                        })
                    });

                    // Pricing Modal
                    $('#pricingModal').on('show.bs.modal', function (e) {
                        $('body').addClass('modal-open');
                    });

                    // Free Plan
                    $('#freePlanBtn').on('click', function () {
                        $.get('/api/subscription/subscribe?planId=1&orgId=<%=orgId%>', function (data) {
                            console.log(data);
                            Swal.fire({
                                title: 'Success!',
                                text: 'You have successfully subscribed to Free Plan',
                                icon: 'success',
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Great!'
                            })
                        });
                    });

                    // Silver Plan
                    $('#silverPlanBtn').on('click', function () {
                        $.get('/api/subscription/subscribe?planId=2&orgId=<%=orgId%>', function (data) {
                            console.log(data);
                            Swal.fire({
                                title: 'Success!',
                                text: 'You have successfully subscribed to Silver Plan',
                                icon: 'success',
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Great!'
                            })
                        });

                    });

                    // Gold Plan
                    $('#goldPlanBtn').on('click', function () {
                        $.get('/api/subscription/subscribe?planId=3&orgId=<%=orgId%>', function (data) {
                            console.log(data);
                            Swal.fire({
                                title: 'Success!',
                                text: 'You have successfully subscribed to Gold Plan',
                                icon: 'success',
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Great!'
                            })
                        });

                    });

                })
            </script>

    </body>

    </html>

    <!-- beautify ignore:end -->